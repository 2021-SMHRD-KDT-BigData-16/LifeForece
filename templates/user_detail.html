<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <meta name="description" content="" />
    <meta name="author" content="" />
    <title>LIFE FORCE</title>
    <link href="https://cdn.jsdelivr.net/npm/simple-datatables@7.1.2/dist/style.min.css" rel="stylesheet" />
    <link href="/static/user_detail.css" rel="stylesheet" />
    <style>
        .tab-content {
            display: none;
        }

        /* Style for active tab */
        .active {
            display: block;
        }

        @font-face {
            font-family: 'Pretendard-Regular';
            src: url('https://cdn.jsdelivr.net/gh/Project-Noonnu/noonfonts_2107@1.1/Pretendard-Regular.woff') format('woff');
            font-weight: 400;
            font-style: normal;
        }
    </style>
    <script src="https://use.fontawesome.com/releases/v6.3.0/js/all.js" crossorigin="anonymous"></script>
    <script>
        function showTab(tabId) {
            var tabContent = document.getElementsByClassName("tab-content");            

            for (var i = 0; i < tabContent.length; i++) {
                tabContent[i].style.display = "none";
            }
            document.getElementById(tabId).style.display = "block";
        }
    </script>
</head>

<body>

    <body class="sb-nav-fixed">
        <nav class="sb-topnav navbar navbar-expand navbar-lifeforce bg-lifeforce">
            <!— Navbar Brand—>
                <img src="/static/lifeforce_3.png" width="50px"
                    style="margin-left: 10px; margin-top : -1px; margin-bottom : 1px;">
                <a class="navbar-brand ps-3" href="/cases/?user={{user}}">LIFE FORCE</a>
                <form class="d-none d-md-inline-block form-inline ms-auto me-0 me-md-3 my-2 my-md-0">
                    <!-- Navbar-->
                    <ul class="navbar-nav ms-auto ms-md-0 me-3 me-lg-4">
                        <li class="nav-item dropdown">
                            <div class="logout_btn" style="margin-right: 153px; margin-top: 0.8px;">
                                <a href="/"><img src="/static/unlock-fill.svg" alt="" style="margin-bottom: 5px;"></a>
                            </div>
                        </li>
                    </ul>
                </form>
        </nav>

        <!-- SCORE TABLE -->
        <div id="layoutSidenav_content">
            <div class="container-fluid px-4">
                <h1 class="mt-4"></h1>
                <ol class="breadcrumb mb-4">
                    <li class="breadcrumb-item active"></li>
                </ol>
                <div class="row1">
                    <div class="col-xl-3 col-md-6">
                        <div class="card bg-light text-gray mb-4">
                            <div class="scorebox">
                                <div class="card-body">LF SCORE</div>
                                <div>
                                    <h1 style="padding:10px; text-align:right; margin-right: 60px;">
                                        {%if case.p_score>=80%}
                                        <b style="color: red">{{case.p_score}}</b>
                                        {%elif case.p_score>=60%}
                                        <b style="color: rgb(255, 191, 0)">{{case.p_score}}</b>
                                        {%else%}
                                        <b style="color: rgb(10, 222, 88)">{{case.p_score}}</b>
                                        {%endif%}
                                    </h1>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-xl-3 col-md-6">
                        <div class="card bg-light text-gray mb-4">
                            <div class="scorebox">
                                <div class="card-body">SOFA SCORE</div>
                                <div>
                                    <h1 style="padding:10px; text-align:right; margin-right: 60px;">
                                        <b>{{case.p_SOFA}}</b>
                                    </h1>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-xl-3 col-md-6">
                        <div class="card bg-light text-gray mb-4">
                            <div class="scorebox">
                                <div class="card-body">MEWS SCORE</div>
                                <div>
                                    <h1 style="padding:10px; text-align:right; margin-right: 60px;">
                                        <b>{{case.p_MEWS}}</b>
                                    </h1>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 프로필 -->
                    <div class="col-xl-3 col-md-6">
                        <div class="card bg-light text-gray mb-8">
                            <div class="card-body">PROFILE
                                <div class="profile">
                                    <div class="d-flex align-items-center justify-content-between"
                                        style="height: 525px;">
                                        <table class="tb"
                                            style="table-layout: fixed; width: 470px; height: 550px; margin-left:2px; margin-top:90px;">
                                            <colgroup>
                                                <col style="width: 75px">
                                                <col style="width: 228px">
                                            </colgroup>
                                            <tr>
                                                <th class="tg-o40d"><b>PID</b></th>
                                                <td class="tg-o40d">{{case.p_id}}</td>
                                            </tr>
                                            <tr>
                                                <th class="tg-o40d"><b>NAME</b></th>
                                                <td class="tg-o40d">{{name}}</td>
                                            </tr>
                                            <tr>
                                                <th class="tg-o40d"><b>AGE</b></th>
                                                <td class="tg-o40d">{{vitals[0].age}}</td>
                                            </tr>
                                            <tr>
                                                <th class="tg-o40d"><b>SEX</b></th>
                                                <td class="tg-o40d">{{"여성" if vitals[0].female==1 else "남성"}}</td>
                                            </tr>
                                            <tr>
                                                {% if vitals %}
                                                <th class="tg-o40d"><b>ICUtpye</b></th>
                                                <td class="tg-o40d">{% if vitals[0].ICUtype == 1 %}
                                                    관상치료실
                                                    {% elif vitals[0].ICUtype == 2 %}
                                                    심장외과회복실
                                                    {% elif vitals[0].ICUtype == 3 %}
                                                    의료 ICU
                                                    {% elif vitals[0].ICUtype == 4 %}
                                                    외과ICU
                                                    {% endif %}</td>
                                            </tr>
                                            <tr>
                                                <th class="tg-o40d"><b>CMT</b></th>
                                                <td class="tg-o40d">{{case.p_cmt}}</td>
                                            </tr>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!--tab 버튼-->
            <div class="btn_container">
                <button id="tabButton1" onclick="showTab('tabContent1')" class="tabtn RR_btn">RR</button>
                <button id="tabButton2" onclick="showTab('tabContent2')" class="tabtn MBP_btn">MBP</button>
                <button id="tabButton3" onclick="showTab('tabContent3')" class="tabtn HR_btn">HR</button>
                <button id="tabButton4" onclick="showTab('tabContent4')" class="tabtn BT_btn">BT</button>
            </div>

            <!-- 그래프 -->
            <!--RR 차트-->
            <div id="tabContent1" class="tab-content" style="display: block;">
                <div class="row">
                    <div class="col-xl-9">
                        <div class="card mb-6">
                            <div class="card-header">
                                <i class="fas fa-chart-area me-1"></i>
                                RR CHART
                            </div>
                            <div class="card-body"><canvas id="RRchart" width="7000%" height="2000%"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!--BMP차트-->
            <div id="tabContent2" class="tab-content">
                <div class="row">
                    <div class="col-xl-9">
                        <div class="card mb-6">
                            <div class="card-header">
                                <i class="fas fa-chart-area me-1"></i>
                                MBP CHART
                            </div>
                            <div class="card-body"><canvas id="MBPchart" width="7000%" height="2000%"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!--HR차트-->
            <div id="tabContent3" class="tab-content">
                <div class="row">
                    <div class="col-xl-9">
                        <div class="card mb-6">
                            <div class="card-header">
                                <i class="fas fa-chart-area me-1"></i>
                                HR CHART
                            </div>
                            <div class="card-body"><canvas id="HRchart" width="7000%" height="2000%"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!--BT차트-->
            <div id="tabContent4" class="tab-content">
                <div class="row">
                    <div class="col-xl-9">
                        <div class="card mb-6">
                            <div class="card-header">
                                <i class="fas fa-chart-area me-1"></i>
                                BT CHART
                            </div>
                            <div class="card-body"><canvas id="BTchart" width="7000%" height="2000%"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <script>
            function fetchPage(caseId, user, name, page, rowsPerPage) {
                var url = `/cases/${caseId}/?user_name=${user}&p_name=${name}&page=${page}&rows_per_page=${rowsPerPage}`;

                fetch(url)
                    .then(response => response.text())
                    .then(html => {
                        var parser = new DOMParser();
                        var newDocument = parser.parseFromString(html, 'text/html');
                        var newContent = newDocument.querySelector('.display-nb');
                        var oldContent = document.querySelector('.display-nb');
                        var newTableContent = newDocument.querySelector('#vitaltable');
                        var oldTableContent = document.querySelector('#vitaltable');

                        oldContent.innerHTML = newContent.innerHTML;
                        oldTableContent.innerHTML = newTableContent.innerHTML;
                    })
                    .catch(error => {
                        console.error('Error fetching page:', error);
                    });
            }
        </script>
        <!-- DATA TABLE -->
        <div class="card mb-3">
            <div class="card-header">
                <!-- Display navigation links or buttons for paging -->
                <div class="display-nb">
                    {% if page > 1 %}
                    <a href="javascript:void(0);"
                        onclick="fetchPage('{{case.p_id}}', '{{ user }}', '{{ name }}', '{{ page - 1 }}', '{{ rows_per_page }}')">Previous</a>
                    {% endif %}

                    <!-- Page numbers -->
                    {% for p in range(1, total_pages + 1) %}
                    {% if p == page %}
                    <strong>{{ p }}</strong>
                    {% else %}
                    <a href="javascript:void(0);"
                        onclick="fetchPage('{{ case.p_id }}', '{{ user }}', '{{ name }}', '{{ p }}', '{{ rows_per_page }}')">{{
                        p }}</a>
                    {% endif %}
                    {% endfor %}

                    <!-- Next page link -->
                    {% if page < total_pages %} <a href="javascript:void(0);"
                        onclick="fetchPage('{{ case.p_id }}', '{{ user }}', '{{ name }}', '{{ page + 1 }}', '{{ rows_per_page }}')">
                        Next</a>
                        {% endif %}
                        <!-- 
                    {% if page > 1 %}
                    <a
                        href="/cases/{{case.p_id}}/?user_name={{user}}&p_name={{name}}&page={{ page - 1 }}&rows_per_page={{ rows_per_page }}">Previous</a>
                    {% endif %}

                    
                    {% for p in range(1, total_pages + 1) %}
                    {% if p == page %}
                    <strong>{{ p }}</strong>
                    {% else %}
                    <a
                        href="/cases/{{case.p_id}}/?user_name={{user}}&p_name={{name}}&page={{ p }}&rows_per_page={{ rows_per_page }}">{{
                        p }}</a>
                    {% endif %}
                    {% endfor %}

                  
                    {% if page < total_pages %} <a
                        href="/cases/{{case.p_id}}/?user_name={{user}}&p_name={{name}}&page={{ page + 1 }}&rows_per_page={{ rows_per_page }}">
                        Next</a>
                        {% endif %}-->
                </div>

                <i class="fas fa-table me-1"></i>
                LIFE FORCE DATATABLE
            </div>
            <div id="vitaltable" style="margin-bottom: 10px; margin-top: 10px;">
                <table class="tg" style="table-layout: fixed; margin: auto">
                    <thead>
                        <tr>
                            <th class="tg-esor">rec_time</th>
                            <th class="tg-esor">HR</th>
                            <th class="tg-esor">RR</th>
                            <th class="tg-esor">SPO2</th>
                            <th class="tg-esor">BT</th>
                            <th class="tg-esor">SBP</th>
                            <th class="tg-esor">DBP</th>
                            <th class="tg-esor">MBP</th>
                            <th class="tg-esor">ALP</th>
                            <th class="tg-esor">Albumin</th>
                            <th class="tg-esor">BUN</th>
                            <th class="tg-esor">Bilirubin</th>
                            <th class="tg-esor">Cholesterol</th>
                            <th class="tg-esor">Creatinine</th>
                            <th class="tg-esor">FiO2</th>
                            <th class="tg-esor">GCS</th>
                            <th class="tg-esor">Glucose</th>
                            <th class="tg-esor">HCO3</th>
                            <th class="tg-esor">HCT</th>
                            <th class="tg-esor">K</th>
                            <th class="tg-esor">Lactate</th>
                            <th class="tg-esor">Mg</th>
                            <th class="tg-esor">Na</th>
                            <th class="tg-esor">PaCO2</th>
                            <th class="tg-esor">PaO2</th>
                            <th class="tg-esor">Platelets</th>
                            <th class="tg-esor">Urine</th>
                            <th class="tg-esor">WBC</th>
                            <th class="tg-esor">pH</th>
                            <th class="tg-esor">MechVent</th>
                        </tr>
                    </thead>

                    <tbody>
                        <!--환자 vital 표 나오는 곳-->
                        {% for vital in vitals %}
                        <tr style="padding:10px;height:45px;" id="casebox_{{vital.u_id}}">

                            <td align="center" class="rectime">{{vital.rec_time}}</td>
                            <td align="center" class="HR">{{vital.HR}}</td>
                            <td align="center" class="RR">{{vital.RR}}</td>
                            <td align="center">{{vital.SPO2}}</td>
                            <td align="center" class="BT">{{vital.BT if vital.BT != -1 else "-"}}</td>
                            <td align="center">{{vital.SBP}}</td>
                            <td align="center">{{vital.DBP}}</td>
                            <td align="center" class="MBP">{{vital.MBP}}</td>
                            <td align="center">{{vital.ALP if vital.ALP != -1 else "-"}}</td>
                            <td align="center">{{vital.Albumin if vital.Albumin != -1 else "-"}}</td>
                            <td align="center">{{vital.BUN if vital.BUN != -1 else "-"}}</td>
                            <td align="center">{{vital.Bilirubin if vital.Bilirubin != -1 else "-"}}</td>
                            <td align="center">{{vital.Cholesterol if vital.Cholesterol != -1 else "-"}}</td>
                            <td align="center">{{vital.Creatinine if vital.Creatinine != -1 else "-"}}</td>
                            <td align="center">{{vital.FiO2 if vital.FiO2 != -1 else "-"}}</td>
                            <td align="center">{{vital.GCS if vital.GCS != -1 else "-"}}</td>
                            <td align="center">{{vital.Glucose if vital.Glucose != -1 else "-"}}</td>
                            <td align="center">{{vital.HCO3 if vital.HCO3 != -1 else "-"}}</td>
                            <td align="center">{{vital.HCT if vital.HCT != -1 else "-"}}</td>
                            <td align="center">{{vital.K if vital.K != -1 else "-"}}</td>
                            <td align="center">{{vital.Lactate if vital.Lactate != -1 else "-"}}</td>
                            <td align="center">{{vital.Mg if vital.Mg != -1 else "-"}}</td>
                            <td align="center">{{vital.Na if vital.Na != -1 else "-"}}</td>
                            <td align="center">{{vital.PaCO2 if vital.PaCO2 != -1 else "-"}}</td>
                            <td align="center">{{vital.PaO2 if vital.PaO2 != -1 else "-"}}</td>
                            <td align="center">{{vital.Platelets if vital.Platelets != -1 else "-"}}</td>
                            <td align="center">{{vital.Urine if vital.Urine != -1 else "-"}}</td>
                            <td align="center">{{vital.WBC if vital.WBC != -1 else "-"}}</td>
                            <td align="center">{{vital.pH if vital.pH != -1 else "-"}}</td>
                            <td align="center">{{vital.MechVent if vital.MechVent != -1 else "-"}}</td>


                            {% endfor %}
                            {% else %}
                        <tr style="padding:10px;border-top:solid 1px #3388cc;">
                            <td>
                                환자의 데이터가 존재하지 않습니다
                            </td>
                        </tr>
                        {% endif %}
                    </tbody>
                </table>
            </div>
        </div>
        </div>
        <div style="height:2px;"></div>

        <!--<script src="/static/scripts.js"></script>-->
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"
            crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.8.0/Chart.min.js"
            crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/simple-datatables@7.1.2/dist/umd/simple-datatables.min.js"
            crossorigin="anonymous"></script>
        <script src="/static/chart-area-demo.js"></script>

    </body>

</html>